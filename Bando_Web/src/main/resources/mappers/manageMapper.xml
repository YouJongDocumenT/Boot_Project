<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="manageMapper">

<!-- 재고 작성 -->
   <insert id="productinsert">
	   INSERT INTO TEST_ALLBOARD(PDTNUM, PRODUCT, PURCHASECOMP, REPOSIBILITY, PWEIGHT
	   							, PLENGTH, QUANTITY, PCHPRICE, PRICE, TAX, DIFFERENCE)
	                 VALUES( TEST_ALLBOARD_SEQ.NEXTVAL, #{product}, #{purchasecomp}, #{reposibility}, #{pweight}
	                 		, #{plength}, #{quantity}, #{pchprice}, #{price}, #{tax}, #{difference} )
   
   </insert>
   
<!-- 재고 조회 -->
   <select id="productlist" resultType="com.bando.dto.manageDTO">
	   SELECT PDTNUM, BUTDATE, PRODUCT, PURCHASECOMP, REPOSIBILITY, PWEIGHT
	   			, PLENGTH, QUANTITY, PCHPRICE, PRICE, TAX, DIFFERENCE
	   		FROM TEST_ALLBOARD
	        ORDER BY PDTNUM DESC  
   </select>
   
 <!-- 재고 수정 -->
   <update id="productupdate" parameterType="com.bando.dto.manageDTO">
	   UPDATE TEST_ALLBOARD
	   		SET PRODUCT = #{product},
	   			PURCHASECOMP = #{purchasecomp},
	   			REPOSIBILITY = #{reposibility},
	   			PWEIGHT = #{pweight},
	   			PLENGTH = #{plength},
	   			QUANTITY = #{quantity},
	   			PCHPRICE = #{pchprice},
	   			PRICE = #{price},
	   			TAX = #{tax},
	   			DIFFERENCE = #{difference}
	   			
	   WHERE PDTNUM = #{pdtnum}  
   </update>
   
<!-- 재고 삭제 -->
   <delete id="productdelete" parameterType="int">
	   DELETE 
			FROM TEST_ALLBOARD
		WHERE PDTNUM = #{pdtnum}  
	                 
   </delete>
   
   <!-- 총 단가, 총 매출, 총 내역 수 출력 -->
   <select id="saleslist" resultType="com.bando.dto.SalesDTO">
    	SELECT SUM(PCHPRICE) AS total_pchprice, 
           	   SUM(DIFFERENCE) AS total_difference,
           	   COUNT(*) AS total_cnt
    		FROM TEST_ALLBOARD
	</select>
   
   <!-- 구매처 회사 정보 작성 -->
   <insert id="purchasecompinsert">
	   INSERT INTO purchasecomp_table(purchase_id, purchase_company, adress, comp_number, email)
	                 VALUES( purchasecomp_table_SEQ.NEXTVAL, #{purchase_company}, #{adress}, #{comp_number}, #{email} )
   
   </insert>
   
<!-- 구매처 회사 정보 조회 -->
   <select id="purchasecomplist" resultType="com.bando.dto.PurchaseCompDTO">
	   SELECT purchase_id, purchase_company, adress, comp_number, email
	   		FROM purchasecomp_table
   </select>
   
<!-- 구매처 회사 매칭해 거래내역 추가 -->
<insert id="purchcomptradelist">
	   INSERT INTO purchase_table (purchase_id, product, pur_quantity, 
	   								purchase_price, pur_length, pur_weight)
	   			VALUES ( #{purchase_id}, #{product}, #{pur_quantity}, #{purchase_price}, #{pur_length}, #{pur_weight})
   </insert>
   
<!-- 구매처 회사 정보 조회 -->
   <select id="purchcompbyid" resultType="com.bando.dto.PurchaseCompDTO">
	   SELECT purchase_company, adress, comp_number, email
	   		FROM purchasecomp_table
	   		WHERE purchase_id = #{purchase_id}
   </select>
 
<!-- 구매 정보 조회 -->
   <select id="purchlistbyid" resultType="com.bando.dto.PurChasePdtDTO">
	   SELECT Product, purchase_date, pur_quantity, purchase_price, pur_length, pur_weight
	   		FROM purchase_table
	   		WHERE purchase_id = #{purchase_id}
   </select>
   
<!-- 고객사 회사 정보 작성 -->
   <insert id="clientinsert">
	   INSERT INTO clientcomp_table(client_id, client_company, address, comp_number, email)
	                 VALUES( clientcomp_table_SEQ.NEXTVAL, #{client_company}, #{address}, #{comp_number}, #{email} )
   
   </insert>
   
<!-- 고객사 회사 정보 조회 -->
   <select id="clientlist" resultType="com.bando.dto.ClientDTO">
	   SELECT client_id, client_company, address, comp_number, email
	   		FROM clientcomp_table
   </select>
     
<!-- 고객사 기계 정보 작성 -->
   <insert id="machineadd">
	   INSERT INTO machine_table(machine_id, client_id, machine_name, machine_memo)
	                 VALUES( machine_table_SEQ.NEXTVAL, #{client_id}, #{machine_name}, #{machine_memo} )
   
   </insert>     
     

<!-- 매칭된 id값의 고객사 회사 정보 조회 -->
   <select id="clientbyid" resultType="com.bando.dto.ClientDTO">
	   SELECT client_id, client_company, address, comp_number, email
	   		FROM clientcomp_table
	   		WHERE client_id = #{client_id}
   </select>
   
<!-- 판매 정보 작성 -->
   <insert id="selladd">
	   INSERT INTO sell_product(client_id, machine_id, responsibility, ph_number, sell_quantity, sell_length, sell_weight, sell_price, tax, sell_pdt )
	                 VALUES( #{client_id}, #{machine_id}, #{responsibility}, #{ph_number}, #{sell_quantity}, #{sell_length}, #{sell_weight}, #{sell_price}, #{tax}, #{sell_pdt} )
   
   </insert>   
        
        
<!-- 매칭된 client_id값의 기계 정보 조회 -->
   <select id="machinebyid" resultType="com.bando.dto.MachineDTO">
	   SELECT machine_id, client_id, machine_name, machine_memo
	   		FROM machine_table
	   		WHERE client_id = #{client_id}
   </select>        
        
        
<!-- 매칭된 machine_id값의 판매 정보 조회 -->
   <select id="sellListbyid" resultType="com.bando.dto.SellpdtDTO">
	   SELECT responsibility, ph_number, sell_date, sell_quantity, sell_length, sell_weight, sell_price, tax, sell_pdt
	   		FROM sell_product
	   		WHERE client_id = #{client_id}
   </select> 
 
 
<!-- 매칭된 값의 판매 정보 조회 -->  
<select id="sellAlldata" parameterType="map" resultType="com.bando.dto.SellAllDataDTO">
    SELECT cc.client_company, cc.address, mt.machine_name, mt.machine_memo, sp.sell_date, sp.responsibility, sp.sell_quantity, sp.sell_length, sp.sell_weight, sp.sell_price, sp.tax, sp.sell_pdt
    FROM clientcomp_table cc
    JOIN machine_table mt ON cc.client_id = mt.client_id
    JOIN sell_product sp ON mt.machine_id = sp.machine_id
    WHERE cc.client_id = #{client_id} AND mt.machine_id = #{machine_id}
</select>  


<!-- 각 구매 관련 테이블의 purchase_id에 매칭된 모든데이터 출력 -->
   <select id="PurChaseMachingDataList" resultType="com.bando.dto.AllPurchaseDataDTO">
	   SELECT *
		FROM purchasecomp_table pc
		JOIN purchase_table pt ON pc.purchase_id = pt.purchase_id
   </select>
   
<!-- 각 구매 관련 테이블의 client_id및 machine_id에 매칭된 모든데이터 출력 -->
   <select id="SellMachingDataList" resultType="com.bando.dto.AllSellDataDTO">
	   SELECT cc.client_company, mt.machine_name, sp.*
		FROM clientcomp_table cc
		JOIN machine_table mt ON cc.client_id = mt.client_id
		JOIN sell_product sp ON mt.machine_id = sp.machine_id
   </select>
 
           
</mapper>












